{% extends "base.html" %}
{% block title %}Track Order · MMVALI Farm{% endblock %}

{% block content %}
<section class="max-w-lg mx-auto px-4 py-10">
  <div class="bg-white rounded-xl shadow p-6">
    <h1 class="text-2xl font-semibold text-emerald-700 mb-3">Track Your Order</h1>

    <p class="text-sm text-slate-600 mb-4">
      Enter your <strong>Order ID</strong> and the <strong>phone number</strong> you used to place the order.
    </p>

    <form method="post" class="space-y-3">
      <div>
        <label class="block text-sm mb-1">Order ID</label>
        <input name="order_id" required class="w-full p-2 border rounded" placeholder="e.g., 12" />
      </div>

      <div>
        <label class="block text-sm mb-1">Phone (used when ordering)</label>
        <input name="phone" required class="w-full p-2 border rounded" placeholder="+91XXXXXXXXXX or 9876XXXXX" />
      </div>

      <div class="flex gap-3">
        <button class="px-4 py-2 bg-emerald-600 text-white rounded">Lookup</button>
        <a href="{{ url_for('index') }}" class="px-4 py-2 border rounded">Cancel</a>
      </div>
    </form>

    {% if error %}
      <div class="mt-4 text-sm text-red-600">{{ error }}</div>
    {% endif %}

    {% if result %}
      <div class="mt-6 border-t pt-4">
        <h3 class="text-lg font-semibold">{{ result.product }} — Order #{{ result.id }}</h3>
        <div class="text-sm text-slate-600 mt-2">
          <div><strong>Name:</strong> {{ result.customer_name }}</div>
          <div><strong>Phone:</strong> {{ result.phone }}</div>
          <div><strong>Quantity:</strong> {{ result.quantity }}</div>
          <div><strong>Total:</strong> ₹{{ result.total_price or 0 }}</div>
          <div class="mt-2">
            <strong>Status:</strong>
            <span class="inline-block ml-2 px-2 py-1 text-xs rounded
             {% if result.status == 'Pending' %}bg-yellow-100 text-yellow-800
             {% elif result.status == 'Processing' %}bg-blue-100 text-blue-800
             {% elif result.status == 'Delivered' %}bg-emerald-100 text-emerald-800
             {% elif result.status == 'Cancelled' %}bg-red-100 text-red-800
             {% else %}bg-slate-100 text-slate-800{% endif %}">
              {{ result.status }}
            </span>
          </div>

          <div class="mt-3">
            <strong>Address:</strong>
            <div class="text-sm text-slate-700">{{ result.address }}</div>
          </div>

          <div class="mt-4 flex gap-2">
            <!-- Offer quick WhatsApp contact link to owner (open WhatsApp with order summary) -->
            <a href="{{ url_for('admin_order_whatsapp', order_id=result.id) }}" target="_blank"
               class="px-3 py-2 bg-green-500 text-white rounded">Contact via WhatsApp</a>

            <!-- Option to refresh the result -->
            <form method="post">
              <input type="hidden" name="order_id" value="{{ result.id }}">
              <input type="hidden" name="phone" value="{{ result.phone }}">
              <button class="px-3 py-2 border rounded">Refresh</button>
            </form>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
